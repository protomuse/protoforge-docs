---
title: "Handling ProtoForge Webhook Events"
description: "Subscribe to license.created, contract.signed, and payment events with payload schemas, signature verification, and retry logic"
---

# Handling ProtoForge Webhook Events

<Callout type="info" title="What This Guide Covers">
  How to subscribe to webhook events, handle event payloads, verify webhook signatures, and implement retry logic for reliable event processing.
</Callout>

## Prerequisites

- Authenticated with the ProtoForge API ([Authentication Guide](/guides/authentication))
- Created at least one license ([Creating Licenses](/guides/creating-licenses))

## Event Types

ProtoForge sends webhook events when resource state changes:

| Event | Trigger | Key Payload Fields |
|-------|---------|-------------------|
| `license.created` | New license created | license_id, track_id, status |
| `license.approved` | License approved | license_id, approved_by |
| `license.expired` | License term ended | license_id, expired_at |
| `contract.generated` | Contract assembled | contract_id, version, confidence_score |
| `contract.signed` | All parties signed | contract_id, signed_at, signers |
| `payment.confirmed` | Payment received | payment_id, amount, currency |
| `payment.failed` | Payment failed | payment_id, error_code, retry_at |

<Steps>

### Create a Webhook Subscription

Register your endpoint URL and specify which events you want to receive:

<CodeGroup>
```typescript TypeScript
const response = await fetch("https://api.protoforge.com/v1/webhooks", {
  method: "POST",
  headers: {
    "Authorization": "Bearer pk_test_your_api_key",
    "Content-Type": "application/json"
  },
  body: JSON.stringify({
    url: "https://your-app.com/webhooks/protoforge",
    events: [
      "license.created",
      "license.approved",
      "contract.generated",
      "contract.signed"
    ]
  })
});

const webhook = await response.json();
console.log(`Webhook ${webhook.id} created`);
```

```bash cURL
curl -X POST "https://api.protoforge.com/v1/webhooks" \
  -H "Authorization: Bearer pk_test_your_api_key" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://your-app.com/webhooks/protoforge",
    "events": ["license.created", "license.approved", "contract.generated", "contract.signed"]
  }'
```

```python Python
import requests

response = requests.post(
    "https://api.protoforge.com/v1/webhooks",
    headers={
        "Authorization": "Bearer pk_test_your_api_key",
        "Content-Type": "application/json"
    },
    json={
        "url": "https://your-app.com/webhooks/protoforge",
        "events": [
            "license.created",
            "license.approved",
            "contract.generated",
            "contract.signed"
        ]
    }
)

webhook = response.json()
print(f"Webhook {webhook['id']} created")
```
</CodeGroup>

**Response (201 Created):**

```json
{
  "id": "whk_def456",
  "url": "https://your-app.com/webhooks/protoforge",
  "events": ["license.created", "license.approved", "contract.generated", "contract.signed"],
  "active": true,
  "created_at": "2026-02-22T15:00:00Z"
}
```

### Handle Incoming Events

When an event occurs, ProtoForge sends a POST request to your webhook URL with the event payload:

```json
{
  "id": "evt_abc789",
  "type": "license.approved",
  "created_at": "2026-02-22T15:30:00Z",
  "data": {
    "license_id": "lic_mno345",
    "approved_by": "admin@your-org.com"
  }
}
```

Your endpoint should:

1. Parse the JSON body
2. Verify the webhook signature (see next step)
3. Process the event based on `type`
4. Return a `200 OK` response within 30 seconds

<CodeGroup>
```typescript TypeScript
// Express.js webhook handler
import express from "express";
import crypto from "crypto";

const app = express();
app.use(express.json());

app.post("/webhooks/protoforge", (req, res) => {
  const event = req.body;

  switch (event.type) {
    case "license.created":
      console.log(`License ${event.data.license_id} created`);
      break;
    case "license.approved":
      console.log(`License ${event.data.license_id} approved by ${event.data.approved_by}`);
      break;
    case "contract.signed":
      console.log(`Contract ${event.data.contract_id} signed at ${event.data.signed_at}`);
      break;
    default:
      console.log(`Unhandled event type: ${event.type}`);
  }

  res.status(200).json({ received: true });
});
```

```python Python
# Flask webhook handler
from flask import Flask, request, jsonify

app = Flask(__name__)

@app.route("/webhooks/protoforge", methods=["POST"])
def handle_webhook():
    event = request.json

    if event["type"] == "license.created":
        print(f"License {event['data']['license_id']} created")
    elif event["type"] == "license.approved":
        print(f"License {event['data']['license_id']} approved by {event['data']['approved_by']}")
    elif event["type"] == "contract.signed":
        print(f"Contract {event['data']['contract_id']} signed at {event['data']['signed_at']}")
    else:
        print(f"Unhandled event type: {event['type']}")

    return jsonify({"received": True}), 200
```

```bash cURL
# Test your webhook handler locally using a cURL simulation
curl -X POST "http://localhost:3000/webhooks/protoforge" \
  -H "Content-Type: application/json" \
  -H "X-ProtoForge-Signature: sha256=abc123" \
  -d '{
    "id": "evt_test001",
    "type": "license.approved",
    "created_at": "2026-02-22T15:30:00Z",
    "data": {
      "license_id": "lic_mno345",
      "approved_by": "admin@your-org.com"
    }
  }'
```
</CodeGroup>

### Verify Webhook Signatures

Every webhook request includes an `X-ProtoForge-Signature` header containing an HMAC-SHA256 signature of the request body. Verify the signature to ensure the event was sent by ProtoForge:

<CodeGroup>
```typescript TypeScript
import crypto from "crypto";

function verifyWebhookSignature(
  body: string,
  signature: string,
  secret: string
): boolean {
  const expected = crypto
    .createHmac("sha256", secret)
    .update(body)
    .digest("hex");

  return `sha256=${expected}` === signature;
}

// In your handler:
const signature = req.headers["x-protoforge-signature"] as string;
const isValid = verifyWebhookSignature(
  JSON.stringify(req.body),
  signature,
  process.env.PROTOFORGE_WEBHOOK_SECRET!
);

if (!isValid) {
  return res.status(401).json({ error: "Invalid signature" });
}
```

```python Python
import hmac
import hashlib

def verify_webhook_signature(body: bytes, signature: str, secret: str) -> bool:
    expected = hmac.new(
        secret.encode(),
        body,
        hashlib.sha256
    ).hexdigest()

    return f"sha256={expected}" == signature

# In your handler:
signature = request.headers.get("X-ProtoForge-Signature", "")
is_valid = verify_webhook_signature(
    request.data,
    signature,
    os.environ["PROTOFORGE_WEBHOOK_SECRET"]
)

if not is_valid:
    return jsonify({"error": "Invalid signature"}), 401
```

```bash cURL
# Generate a test signature for local testing
echo -n '{"id":"evt_test001","type":"license.approved"}' | \
  openssl dgst -sha256 -hmac "your_webhook_secret"
```
</CodeGroup>

### Implement Retry Logic

ProtoForge retries failed webhook deliveries with exponential backoff:

| Attempt | Delay | Total Time |
|---------|-------|------------|
| 1st retry | 1 minute | 1 min |
| 2nd retry | 5 minutes | 6 min |
| 3rd retry | 30 minutes | 36 min |
| 4th retry | 2 hours | ~2.5 hours |
| 5th retry | 12 hours | ~14.5 hours |

After 5 failed retries, the event is marked as failed and the webhook is deactivated. Re-enable the webhook from the dashboard or by creating a new subscription.

Your endpoint should be **idempotent** — use the `event.id` to deduplicate events in case of retries.

</Steps>

## Managing Webhooks

### List Active Webhooks

<CodeGroup>
```typescript TypeScript
const response = await fetch("https://api.protoforge.com/v1/webhooks", {
  headers: { "Authorization": "Bearer pk_test_your_api_key" }
});

const webhooks = await response.json();
```

```bash cURL
curl -X GET "https://api.protoforge.com/v1/webhooks" \
  -H "Authorization: Bearer pk_test_your_api_key"
```

```python Python
import requests

response = requests.get(
    "https://api.protoforge.com/v1/webhooks",
    headers={"Authorization": "Bearer pk_test_your_api_key"}
)
```
</CodeGroup>

**Response:**

```json
[
  {
    "id": "whk_def456",
    "url": "https://your-app.com/webhooks/protoforge",
    "events": ["license.created", "license.approved"],
    "active": true,
    "created_at": "2026-02-22T15:00:00Z"
  }
]
```

### Delete a Webhook

<CodeGroup>
```typescript TypeScript
await fetch("https://api.protoforge.com/v1/webhooks/whk_def456", {
  method: "DELETE",
  headers: { "Authorization": "Bearer pk_test_your_api_key" }
});
// Returns 204 No Content
```

```bash cURL
curl -X DELETE "https://api.protoforge.com/v1/webhooks/whk_def456" \
  -H "Authorization: Bearer pk_test_your_api_key"
```

```python Python
import requests

response = requests.delete(
    "https://api.protoforge.com/v1/webhooks/whk_def456",
    headers={"Authorization": "Bearer pk_test_your_api_key"}
)
# Returns 204 No Content
```
</CodeGroup>

<Accordion title="Common Mistakes">

**Not returning 200 within 30 seconds**
ProtoForge considers any non-2xx response or timeout as a failed delivery and schedules a retry. Keep webhook processing fast — offload heavy work to a background queue.

**Not verifying signatures**
Always verify the `X-ProtoForge-Signature` header. Without verification, any external party could send fake events to your endpoint.

**Not deduplicating events**
Retries can deliver the same event multiple times. Use the `event.id` field to detect and skip duplicate deliveries.

</Accordion>

## Next Steps

<Card title="Bulk License Import" icon="upload" href="/guides/bulk-operations">
  Upload CSV files to create multiple licenses in a single batch operation.
</Card>
